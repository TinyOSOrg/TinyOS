[bits 32]

%define WITH_ERR_CODE push 0
%define WITHOUT_ERR_CODE nop

extern put_str

section INTR_ENTRY

output_str db "Hello, interrupt!", 0xa, 0

%macro INTR_VECTOR 2
    section INTR_VEC
    intr_%1_entry:
        ; 统一错误码所占栈空间
        %2
        ; 输出中断提示
        push output_str
        call put_str
        add esp, 4
        
        mov al, 0x20
        out 0xa0, al
        out 0x20, al
    
        ; 弹出错误码
        add esp, 4
    
        iret
    section INTR_ENTRY
        dd intr_%1_entry
%endmacro

global intr_entry_table
intr_entry_table:

INTR_VECTOR 0x00, WITH_ERR_CODE
INTR_VECTOR 0x01, WITH_ERR_CODE
INTR_VECTOR 0x02, WITH_ERR_CODE
INTR_VECTOR 0x03, WITH_ERR_CODE 
INTR_VECTOR 0x04, WITH_ERR_CODE
INTR_VECTOR 0x05, WITH_ERR_CODE
INTR_VECTOR 0x06, WITH_ERR_CODE
INTR_VECTOR 0x07, WITH_ERR_CODE 
INTR_VECTOR 0x08, WITHOUT_ERR_CODE
INTR_VECTOR 0x09, WITH_ERR_CODE
INTR_VECTOR 0x0a, WITHOUT_ERR_CODE
INTR_VECTOR 0x0b, WITHOUT_ERR_CODE 
INTR_VECTOR 0x0c, WITH_ERR_CODE
INTR_VECTOR 0x0d, WITHOUT_ERR_CODE
INTR_VECTOR 0x0e, WITHOUT_ERR_CODE
INTR_VECTOR 0x0f, WITH_ERR_CODE 
INTR_VECTOR 0x10, WITH_ERR_CODE
INTR_VECTOR 0x11, WITHOUT_ERR_CODE
INTR_VECTOR 0x12, WITH_ERR_CODE
INTR_VECTOR 0x13, WITH_ERR_CODE 
INTR_VECTOR 0x14, WITH_ERR_CODE
INTR_VECTOR 0x15, WITH_ERR_CODE
INTR_VECTOR 0x16, WITH_ERR_CODE
INTR_VECTOR 0x17, WITH_ERR_CODE 
INTR_VECTOR 0x18, WITHOUT_ERR_CODE
INTR_VECTOR 0x19, WITH_ERR_CODE
INTR_VECTOR 0x1a, WITHOUT_ERR_CODE
INTR_VECTOR 0x1b, WITHOUT_ERR_CODE 
INTR_VECTOR 0x1c, WITH_ERR_CODE
INTR_VECTOR 0x1d, WITHOUT_ERR_CODE
INTR_VECTOR 0x1e, WITHOUT_ERR_CODE
INTR_VECTOR 0x1f, WITH_ERR_CODE 
INTR_VECTOR 0x20, WITH_ERR_CODE
